- become: true
  become_user: root
  gather_facts: F
  hosts: 127.0.0.1
  tasks:
  - name: ping the machine
    ping: null
  - name: add user
    user:
      append: true
      name: '{{username}}'
      password: '{{password | password_hash("sha512")}}'
      shell: /bin/bash
  - action: file path=/home/{{username}}/.ssh mode=0700 state=directory owner={{username}}
      group={{username}}
    name: create key directory
  - authorized_key:
      key: '{{public_key}}'
      state: present
      user: '{{username}}'
    name: set authorized key
  vars:
    ansible_ssh_port: '22222'
    ansible_ssh_private_key_file: /Users/mi/git/tea-eggs/taskService/test/sshkey/eggs_rsa
    ansible_ssh_user: ops
    password: '123456'
    public_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCV0SMm8r9tycALVtCEKWlebDpcRQRq0iunZsu3sFoQaTjG8me9d603c5dnXbEMDNCSNgKvaz6gfJbsFfYq4Gg8qWAPSb10TeveZq65QAzOlpCK0xk/GpyZcJlaXQT5ymbN8I9BlMUosYIWKLwMqC33LoHqycsnxvJKdw++VvgUO3KFrUm+YaHr3/3XxCeBRYzYyUmHiAreqmnaLIcELYmhuk7PiX3Z8gYPJ/DprplDyDUWguwlp+1msBvNJR2afUA22tALP3ZDoEZ5iUHxR1Ml+GkIo1LtH1KWFMtlljwwpymINAz3pUXAg/aZmcN2UFKuivSbALV6TJt6j1pgnTl3
      tea-eggs
    username: MMM
